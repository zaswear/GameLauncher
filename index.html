// En tu <script> de index.html, reemplaza solo esta función

function toggleDetails(gameId) {
    const detailsPanel = document.getElementById('details-panel');
    const game = allGamesData.find(g => g.id === gameId);

    if (!gameId || detailsPanel.classList.contains('active')) {
        detailsPanel.classList.add('modal-leave');
        setTimeout(() => {
            detailsPanel.classList.add('hidden');
            detailsPanel.classList.remove('modal-leave', 'active');
            detailsPanel.innerHTML = '';
        }, 300);
    } else if (game) {
        // Lógica para mostrar el tráiler: video si existe, si no, la imagen.
        let mediaElement = game.trailerUrl ?
            `<video controls autoplay muted loop class="w-full h-full rounded">
                <source src="${game.trailerUrl}" type="video/mp4">
                Tu navegador no soporta el vídeo.
            </video>` :
            `<img src="${game.imageUrl}" alt="${game.title}" class="rounded-lg shadow-lg w-full">`;

        detailsPanel.innerHTML = `
            <div class="relative w-full max-w-4xl bg-gray-800 border border-gray-700 rounded-xl shadow-2xl p-6 m-4 modal-enter" onclick="event.stopPropagation()">
                <button onclick="window.toggleDetails()" class="absolute top-2 right-4 text-3xl font-light text-gray-400 hover:text-white">&times;</button>
                <div class="flex flex-col md:flex-row gap-6">
                    <div class="flex-shrink-0 w-full md:w-1/3">
                        <div class="aspect-w-16 aspect-h-9 mb-4">${mediaElement}</div>
                        ${game.steamUrl ? `<a href="${game.steamUrl}" target="_blank" rel="noopener noreferrer" class="block w-full text-center bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg transition-colors">Ver en Steam</a>` : ''}
                    </div>
                    <div class="flex-grow">
                        <h2 class="text-3xl font-bold text-indigo-400 mb-2">${game.title}</h2>
                        <p class="mb-4"><span class="font-bold text-gray-300">Lanzamiento:</span> ${game.releaseDateString}</p>
                        <p class="text-sm text-gray-400 italic">${game.notes}</p>
                    </div>
                </div>
            </div>
        `;
        detailsPanel.classList.remove('hidden');
        detailsPanel.classList.add('active');
        detailsPanel.onclick = () => toggleDetails();
    }
}
window.toggleDetails = toggleDetails;