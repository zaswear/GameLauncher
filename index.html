<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Biblioteca de Juegos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #0d1117; color: #e6e6e6; }
        .spinner { border: 3px solid rgba(255, 255, 255, 0.3); border-top: 3px solid #818cf8; border-radius: 50%; width: 16px; height: 16px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .game-card { transition: transform 0.2s ease-out, box-shadow 0.2s ease-out; background-color: #161b22; }
        .game-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.4); }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8 flex flex-col">

    <main class="max-w-7xl mx-auto w-full flex-grow">
        <header class="mb-8 p-4 bg-gray-900/50 backdrop-blur-sm border border-gray-700 rounded-xl shadow-2xl">
            <h1 class="text-3xl md:text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 to-purple-500 mb-2">
                ðŸŽ® Mi Biblioteca de Juegos
            </h1>
            <p id="stats-summary" class="text-gray-400 font-semibold"></p>
        </header>

        <div id="error-message" class="hidden bg-red-800 p-4 rounded-lg mb-4 text-sm"></div>
        <div id="game-grid-container" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 min-h-[300px]">
            </div>
    </main>

    <footer class="max-w-7xl mx-auto w-full mt-12 py-6 text-center text-gray-500 border-t border-gray-700">
        <p>Creado por Ignacio PÃ©rez</p>
    </footer>

    <script type="module">
        async function fetchMyGames() {
            const container = document.getElementById('game-grid-container');
            container.innerHTML = `<div class="col-span-full text-center py-20 text-lg text-indigo-400">Cargando tu biblioteca de Steam... <span class="spinner inline-block ml-2"></span></div>`;
            try {
                const response = await fetch('/api/getMySteamGames');
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'Error del servidor.');
                }
                const games = await response.json();
                
                // Ordenamos por horas jugadas, de mÃ¡s a menos
                games.sort((a, b) => b.playtime - a.playtime);
                
                renderGameGrid(games);
                renderStats(games);

            } catch (error) {
                document.getElementById('error-message').textContent = `No se pudieron cargar tus juegos. Error: ${error.message}`;
                document.getElementById('error-message').classList.remove('hidden');
                container.innerHTML = '';
            }
        }
        
        function renderGameGrid(games) {
            const container = document.getElementById('game-grid-container');
            container.innerHTML = '';

            games.forEach(game => {
                const card = document.createElement('div');
                card.className = 'game-card rounded-lg shadow-lg overflow-hidden';
                
                const playtimeText = game.playtime > 0 ? `${game.playtime} horas` : 'Sin jugar';
                const statusColor = game.playtime > 0 ? 'bg-green-500' : 'bg-gray-500';

                card.innerHTML = `
                    <div class="relative">
                        <img src="${game.imageUrl}" alt="${game.title}" class="w-full h-40 object-cover">
                        <div class="absolute top-2 right-2 px-2 py-1 text-xs font-bold text-white rounded-full ${statusColor}">${playtimeText}</div>
                    </div>
                    <div class="p-4">
                        <h3 class="text-lg font-bold text-white truncate">${game.title}</h3>
                        <div class="flex items-center mt-2">
                             <svg class="w-5 h-5 mr-2" viewBox="0 0 24 24" fill="currentColor"><path d="M12.1,2.6c-5.5,0-10,4.2-10,9.4c0,0,0,0,0,0c0,4,2.7,7.4,6.4,8.8l2.1-2.2c-0.8-0.3-1.5-0.8-2.1-1.4 c-1.2-1.3-1.8-3-1.8-4.7c0-3.7,3.3-6.8,7.4-6.8s7.4,3,7.4,6.8c0,1.8-0.7,3.6-2.1,4.9c-0.6,0.6-1.3,1.1-2.1,1.4l2.1,2.2 c3.7-1.4,6.4-4.8,6.4-8.8C22.1,6.8,17.6,2.6,12.1,2.6z M10,12.5c-0.8,0-1.5-0.7-1.5-1.5c0-0.8,0.7-1.5,1.5-1.5s1.5,0.7,1.5,1.5 C11.5,11.8,10.8,12.5,10,12.5z M14.2,12.5c-0.8,0-1.5-0.7-1.5-1.5c0-0.8,0.7-1.5,1.5-1.5s1.5,0.7,1.5,1.5 C15.7,11.8,15,12.5,14.2,12.5z"/></svg>
                            <span class="text-sm text-gray-400">${game.platform}</span>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }
        
        function renderStats(games) {
            const totalGames = games.length;
            const playedGames = games.filter(g => g.playtime > 0).length;
            const totalHours = games.reduce((sum, g) => sum + g.playtime, 0).toFixed(0);

            document.getElementById('stats-summary').textContent = 
                `Total: ${totalGames} juegos | Jugados: ${playedGames} | Horas Totales: ${totalHours}`;
        }

        function main() {
            fetchMyGames();
        }

        main();
    </script>
</body>
</html>